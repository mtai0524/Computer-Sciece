@page
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@{
    // Layout = "_Layout";
    Layout = "~/Areas/Admin/Views/Shared/_AdminLayout.cshtml";

}
<component type="typeof(App)" render-mode="ServerPrerendered" />

<script>
    function showText() {
        return alert("hello");
    }
</script>
<script>
    function clearInputFileText(inputId) {
        var input = document.getElementById(inputId);
        if (input) {
            input.value = '';
        }
    }
    function showModal(modalId) {
        const modal = document.getElementById(modalId);
        modal.style.display = 'block';
    }

    function closeModal(modalId) {
        const modal = document.getElementById(modalId);
        modal.style.display = 'none';
    }

    document.addEventListener('click', function (event) {
        if (event.target.classList.contains('close')) {
            closeModal(event.target.closest('.modal').id);
        }
    });


    function drapAndDrop() {
        var columns = document.querySelectorAll('.project-column');
        columns.forEach(function (column) {
            new Sortable(column, {
                group: 'tasks', 
                animation: 500, 
                ghostClass: 'task-placeholder',
                filter: '.project-column-heading__title',
                onEnd: async function (evt) {
                    var tasks = evt.to.querySelectorAll('.task');
                    tasks.forEach(async function (task, index) {
                        console.log(task.toString() + " " +index.toString());
                        // Lấy id của task từ data-attribute hoặc các thuộc tính khác phù hợp
                        var taskId = task.getAttribute('data-task-id');
                        // Cập nhật vị trí của task trong cơ sở dữ liệu
                        await updateTaskPosition(taskId, index);
                    });
                }
            });
        });
    }
    async function updateTaskPosition(taskId, position) {
        // Gửi request để cập nhật vị trí của task trong cơ sở dữ liệu bằng AJAX
        $.ajax({
            url: `/api/tasks/${taskId}`,
            method: 'PUT',
            contentType: 'application/json',
            data: JSON.stringify({ position: position }),
            success: function (data) {
                console.log('Cập nhật vị trí task thành công:', data);
            },
            error: function (xhr, textStatus, errorThrown) {
                console.error('Lỗi khi cập nhật vị trí task:', textStatus, errorThrown);
            }
        });
    }
    function initProjectTasks() {
        // Tạo một Sortable instance cho mỗi cột
        var columns = document.querySelectorAll('.project-column');
        columns.forEach(function (column) {
            new Sortable(column, {
                group: 'tasks', // Group cho phép kéo thả giữa các cột
                animation: 500, // Thời gian animation khi di chuyển
                ghostClass: 'task-placeholder', // Class của phần tử placeholder khi kéo thả
                filter: '.project-column-heading__title',
                
            });
        });
    }

</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.14.0/Sortable.min.js"></script>
<script src="~/js/site.js"></script>